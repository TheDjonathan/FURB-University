.MODEL	SMALL

; I/O definição das IOs 

; 8251A - TERMINARL BURRO(NEM TANTO)
IO2  EQU  0400h

;8253A - SOM
IO3  EQU  0600h

;-------


;8251A - TERMINAL BURRO 
ADR_USART_DATA EQU  (IO2 + 00h)
ADR_USART_CMD  EQU  (IO2 + 02h)
ADR_USART_STAT EQU  (IO2 + 02h)


;8253A Timer
ADR_TIMER_DATA0   EQU  (IO3 + 00h)
ADR_TIMER_DATA1   EQU  (IO3 + 02h)
ADR_TIMER_DATA2   EQU  (IO3 + 04h)
ADR_TIMER_CONTROL EQU  (IO3 + 06h)

TIMER_COUNTER0	EQU 00h
TIMER_COUNTER1	EQU 40h
TIMER_COUNTER2	EQU 80h

.8086
.code

MACRO_INICIALIZA_8253_TIMER0 MACRO HIGH,LOW,DELAY
   PUSHF
   PUSH AX
   PUSH CX
   PUSH DX
   
   MOV AL,36H
   MOV DX, ADR_TIMER_CONTROL
   OUT DX,AL

   MOV AL,LOW
   MOV DX, ADR_TIMER_DATA0
   OUT DX,AL

   MOV AL,HIGH
   MOV DX, ADR_TIMER_DATA0
   OUT DX,AL
   
   MOV CX, DELAY
   
   LOOP $

   POP DX
   POP CX
   POP AX
   POPF
ENDM
ORG 0400H

INICIALIZA_8251: ;TERMINAL BURRO
   XOR AL,AL
   MOV DX, ADR_USART_CMD
   OUT DX,AL
   OUT DX,AL
   OUT DX,AL
   MOV AL,40H
   OUT DX,AL
   MOV AL,4DH
   OUT DX,AL
   MOV AL,37H
   OUT DX,AL
   RET 

;Rotina da emulação da INT21   
INT_21_EMULADA:
    PUSH SI
    PUSH AX
    MOV SI,DX
PROCURA_CIFRAO:	
    MOV AL,[SI]
    CMP AL,"$"
    JE SAI_INT_21_EMULADA
    CALL MANDA_CARACTER
    INC SI
    JMP PROCURA_CIFRAO
SAI_INT_21_EMULADA:
    POP AX
    POP SI
    RET

MANDA_CARACTER:
   PUSHF
   PUSH DX
   PUSH AX  ; SALVA AL
   MOV DX, ADR_USART_DATA
BUSY:
   MOV DX, ADR_USART_STAT
   IN  AL,DX
   TEST AL,1
   JZ BUSY
   MOV DX, ADR_USART_DATA
   POP AX  ; RESTAURA AL
   OUT DX,AL
   POP DX
   POPF
   RET 

.startup
;COMEÇA
	MOV AX,0000
	MOV DS,AX
	
	;SETA REGISTRADORES
	MOV AX,@DATA
	MOV DS,AX
	MOV AX,@STACK
	MOV SS,AX
	
	;começa de verdade
	;Imprime Castelo
	LEA  DX, castelo1
        CALL INT_21_EMULADA
	
COMECA:
	  ;FORMULA PARA OBTER AS NOTAS
	  	;100000 / FREQUENCIA DA NOTA -> HEXADECIMAL

      ;INTRODUCAO
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      
      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G       
      ;INTRODUCAO PART2
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      
      MACRO_INICIALIZA_8253_TIMER0 00H,097H,60000  ; 698HZ NOTA E 	
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      
      MACRO_INICIALIZA_8253_TIMER0 00H,097H,60000  ; 698HZ NOTA E 	
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,00H,60000   ; VAZIU
          
REPETE:
      ;ATO 1
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,30000  ; 523HZ NOTA G 

      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,30000  ; 783HZ NOTA C
   
      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,07FH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C

      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,10000  ; 698HZ NOTA D
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 

	
      ;INTERSEÇÃO1
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      

	
      ;ATO2 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
	
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
	
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,8FH,60000   ; 698HZ NOTA F
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      
	
      MACRO_INICIALIZA_8253_TIMER0 00H,0A0H,60000  ; 622HZ NOTA D# 
      MACRO_INICIALIZA_8253_TIMER0 00H,0AAH,60000  ; 698HZ NOTA D ;AA
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,10000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
	 
      ;INTERSECAO2
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0F0H,60000  ; 783HZ NOTA G#
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
	
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0FFH,60000  ; 523HZ NOTA G 
      MACRO_INICIALIZA_8253_TIMER0 00H,0F0H,60000  ; 783HZ NOTA G#
      MACRO_INICIALIZA_8253_TIMER0 00H,0D6H,60000  ; 622HZ NOTA A#
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
      MACRO_INICIALIZA_8253_TIMER0 00H,0BFH,60000  ; 783HZ NOTA C
	
      DEC varCompara
      CMP varCompara, 1
      JE REPETE
      CMP varCompara, 0
      JE TERMINA

      TERMINA:
      ;Desenvolvido por
      MACRO_INICIALIZA_8253_TIMER0 00H,00h,60000  ; deixa sem som
      LEA  DX, desenvolvidoPor
      CALL INT_21_EMULADA   
     
     FIM:
      JMP FIM
      
      


.DATA



castelo1 db " ",10,13
db"                                 A",13
db"                                / \",13
db"                               /   \",13
db"              A               <_____>",13
db"             / \            _ _|_Y_|_ _",13
db"            /   \           ]=I=I=I=I=[",13
db"           <_____>           \-|-|-|-/",13
db"         _ _|_Y_|_ _          |     |",13
db"         ]=I=I=I=I=[         _|_ _  |            A",13
db"          \-|-|-|-/          ]=I=[  |      A    / \",13
db"           |     |    A       \|/   |     / \  /   \",13
db"           |     |   / \      |Y    |    /   \<_____>",13
db"           | /^\ |  /   \     |     |   <_____>|   |",13
db"           | | | | <_____>    | []  | _ _|_Y_|_|   |",13
db"           | |_| |  |   |     |     | ]=I=I=I=I|   |",13
db"           |     | _|_Y_|_ _  |     |  \-|-|_ _|_Y_|_ _",13
db"           |     |=I=I=I=I=[  |  [] |       ]=I=I=I=I=[",13
db"        _ _|_ _ _|_-_-|-|-/_ _|_ _ _|_ /^\   \-|-|-|-/",13
db"        ]=I=I=I=I=I=[    | ]=I=I=I=I=I=|O|    |     |",13
db"         \-|-|-|-|-/     |  \-\-|-|-/-/ \|    | /^\ |",13
db"          |    [] | _ _ _|_ _|  _____|_ |     | | | |",13
db"          | []    |=I=I=I=I=[| /vvvvvvv\|     | === |",13
db"       _ _|_ _ _ _|_-_-|-|-/ |/vvvvvvvvv\     |     |",13
db"       ]=I=I=I=I=I=I=[    |  <===========> _ _|_ _ _|_ _",13
db"        \-\--|-|--/-/     |  || []   [] |  ]=I=I=I=I=I=[",13
db"         |         | _ _ _|_ ||_ _ _ _ _|_ _\--|-|-|--/",13
db"         |         |=I=I=I=I=I=I=I=I=I=I=I=I=|       |",13
db"         | []      |-=-=-=-=-=-=-=-=-=-=-=-=-|     []|",13
db"         |         |           ___           |       |",13
db"         |         |          /   \          |       |",13
db"         |         |         |     |         |       |",13
db"       _/|         |\_       |     |       _/|       |\_$",13


desenvolvidoPor db " ",10,13 
db " ",10,13 
db"Desenvolvido por Djonathan Krause e Marlon Voss$"


varCompara db 2
			
.STACK
   MINHA_PILHA DW 128 DUP(?)

END
